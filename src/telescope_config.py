import numpy as np

# Separate utility function for loading antenna config

def load_array(position_file='',L=48,N=6,telescope='A12'):
    # position_file: .npy file
    # L: number of subarrays
    # N: elements in each subarray
    # telescope: 'SKA' or 'A12'
    antpos=np.load(position_file)
    fv=np.zeros((L,N),dtype=np.int32)
    if telescope=='SKA':
        # 0-indexing
        fv=np.array([
           [30, 45, 53, 81, 90, 102, ],
           [102, 137, 164, 171, 206, 242, ],
           [111, 113, 117, 126, 132, 144, ],
           [144, 147, 170, 197, 209, 235, ],
           [0, 4, 5, 53, 76, 136, ],
           [136, 139, 140, 173, 209, 234, ],
           [11, 32, 80, 128, 129, 152, ],
           [152, 166, 183, 209, 216, 254, ],
           [9, 26, 41, 60, 82, 135, ],
           [82, 135, 138, 192, 211, 251, ],
           [72, 117, 126, 134, 141, 187, ],
           [187, 205, 226, 231, 232, 251, ],
           [9, 26, 41, 61, 82, 135, ],
           [135, 138, 147, 192, 211, 251, ],
           [3, 8, 20, 62, 66, 97, ],
           [97, 104, 139, 185, 218, 243, ],
           [1, 14, 32, 48, 58, 79, ],
           [58, 79, 135, 147, 151, 156, ],
           [11, 44, 103, 123, 157, 158, ],
           [158, 169, 206, 221, 227, 238, ],
           [11, 44, 103, 157, 158, 169, ],
           [12, 27, 34, 64, 70, 136, ],
           [136, 163, 177, 203, 221, 230, ],
           [20, 47, 49, 69, 77, 95, ],
           [95, 165, 166, 192, 253, 255, ],
           [27, 58, 59, 68, 81, 85, ],
           [85, 140, 144, 215, 237, 244, ],
           [28, 55, 62, 81, 98, 115, ],
           [115, 124, 178, 189, 213, 223, ],
           [71, 87, 90, 99, 107, 193, ],
           [193, 208, 221, 226, 234, 250, ],
           [49, 67, 108, 152, 162, 194, ],
           [194, 201, 220, 228, 238, 242, ],
           [7, 38, 45, 62, 68, 69, ],
           [69, 106, 154, 192, 225, 230, ],
           [70, 136, 163, 195, 221, 230, ],
           [17, 59, 120, 133, 136, 137, ],
           [137, 207, 229, 232, 234, 248, ],
           [67, 108, 146, 152, 162, 194, ],
           [24, 65, 68, 102, 130, 135, ],
           [135, 158, 191, 195, 200, 253, ],
           [30, 47, 99, 110, 111, 119, ],
           [111, 119, 122, 135, 154, 199, ],
           [16, 29, 37, 44, 59, 62, ],
           [62, 65, 119, 162, 207, 214, ],
           [30, 45, 53, 90, 102, 137, ],
           [18, 34, 44, 73, 93, 99, ],
           [99, 137, 172, 180, 184, 217, ],
           [18, 71, 77, 78, 161, 203, ],
           [161, 203, 221, 234, 242, 247, ],
           [11, 78, 109, 138, 146, 159, ],
           [146, 159, 174, 200, 215, 226, ],
           [65, 76, 119, 162, 207, 214, ],
           ], dtype=np.int32)
    else:
       # 1-indexing
       fv[0]=[31,32,33,34,35,36]
       fv[1]=[37,38,39,40,41,42]
       fv[2]=[26,29,34,40,45,48]
       fv[3]=[25,28,33,39,44,47]
       fv[4]=[1,4,9,15,20,23]
       fv[5]=[2,5,10,16,21,24]
       fv[6]=[7,8,9,10,11,12]
       fv[7]=[13,14,15,16,17,18]
       fv[8]=[55,56,57,58,59,60]
       fv[9]=[61,62,63,64,65,66]
       fv[10]=[50,53,58,64,69,72]
       fv[11]=[49,52,57,63,68,71]
       fv[12]=[74,77,82,88,93,96]
       fv[13]=[73,76,81,87,92,95]
       fv[14]=[79,80,81,82,83,84]
       fv[15]=[85,86,87,88,89,90]
       fv[16]=[457,460,465,471,476,479]
       fv[17]=[458,461,466,472,477,480]
       fv[18]=[463,464,465,466,467,468]
       fv[19]=[469,470,471,472,473,474]
       fv[20]=[444,443,442,441,440,439]
       fv[21]=[450,449,448,447,446,445]
       fv[22]=[434,437,442,448,453,456]
       fv[23]=[433,436,441,447,452,455]
       fv[24]=[314,317,322,328,333,336]
       fv[25]=[313,316,321,327,332,335]
       fv[26]=[324,323,322,321,320,319]
       fv[27]=[330,329,328,327,326,325]
       fv[28]=[396,395,394,393,392,391]
       fv[29]=[402,401,400,399,398,397]
       fv[30]=[386,389,394,400,405,408]
       fv[31]=[385,388,393,399,404,407]
       fv[32]=[361,364,369,375,380,383]
       fv[33]=[362,365,370,376,381,384]
       fv[34]=[372,371,370,369,368,367]
       fv[35]=[378,377,376,375,374,373]
       fv[36]=[338,341,346,352,357,360]
       fv[37]=[337,340,345,351,356,359]
       fv[38]=[348,347,346,345,344,343]
       fv[39]=[354,353,352,351,350,349]
       fv[40]=[247,248,249,250,251,252]
       fv[41]=[253,254,255,256,257,258]
       fv[42]=[241,244,249,255,260,263]
       fv[43]=[242,245,250,256,261,264]
       fv[44]=[145,148,153,159,164,167]
       fv[45]=[146,149,154,160,165,168]
       fv[46]=[151,152,153,154,155,156]
       fv[47]=[157,158,159,160,161,162]

       # change to 0-indexing
       fv=fv-1

     
    return antpos,fv



#antpos,fv=load_array(position_file='a12pos.npy',L=48,N=6,telescope='A12')
#fv=fv.reshape(-1,1)
#print(fv.shape)
